from scapy.all import IP, TCP, sr, L3RawSocket, conf, RandShort
import socket
import threading

class PortScan:
	def synScan(self, host, porta):
		with semaforo:
			conf.L3socket = L3RawSocket
			conf.verb = 0

			pacote_ip = IP(dst=host)
			pacote_tcp = TCP(
				dport=porta,
				sport=RandShort(),
				flags="S",
				seq=1000,
				options=[("MSS",1460),("NOP",None),("WScale", 7)]
			)

			pkg, unpkg = sr(pacote_ip/pacote_tcp, timeout=1)

			if pkg:
				for snd, rcv in pkg:
					if rcv.haslayer(TCP):
						if rcv[TCP].flags  == 0x012:
							open = f"{porta}/tcp"
							try:
								print(f"{open:<15} {portas[porta]}")
							except:
								print (f"{open:<15} SLA")

	def checkPort(self, host, porta):
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.settimeout(0.1)
		if s.connect_ex((host, porta)) == 0:
			open = f"{porta}/tcp"
			try:
				print (f"{open:<15} {portas[porta]}")
			except:
				print (f"{open:<15} SLA")
		s.close()

	def getIP(self, host):
		s = socket.getaddrinfo(host, None, socket.AF_INET)
		return s[2][4][0]


	def scanning(self, addr, tipo, tport):

		global portas, semaforo

		if tport == 0:
			# 1K PRINCIPAIS PORTAS USADAS PELO NMAP
			portas = {80:'http',23:'telnet',443:'https',21:'ftp',22:'ssh',25:'smtp',3389:'ms-wbt-server',110:'pop3',445:'microsoft-ds',139:'netbios-ssn',143:'imap',53:'domain',135:'msrpc',3306:'mysql',8080:'http-proxy',1723:'pptp',111:'rpcbind',995:'pop3s',993:'imaps',5900:'vnc',1025:'NFS-or-IIS',587:'submission',8888:'sun-answerbook',199:'smux',1720:'h323q931',465:'smtps',548:'afp',113:'ident',81:'hosts2-ns',6001:'X11:1',10000:'snet-sensor-mgmt',514:'shell',5060:'sip',179:'bgp',1026:'LSA-or-nterm',2000:'cisco-sccp',8443:'https-alt',8000:'http-alt',32768:'filenet-tms',554:'rtsp',26:'rsftp',1433:'ms-sql-s',49152:'unknown',2001:'dc',515:'printer',8008:'http',49154:'unknown',1027:'IIS',5666:'nrpe',646:'ldp',5000:'upnp',5631:'pcanywheredata',631:'ipp',49153:'unknown',8081:'blackice-icecap',2049:'nfs',88:'kerberos-sec',79:'finger',5800:'vnc-http',106:'pop3pw',2121:'ccproxy-ftp',1110:'nfsd-status',49155:'unknown',6000:'X11',513:'login',990:'ftps',5357:'wsdapi',427:'svrloc',49156:'unknown',543:'klogin',544:'kshell',5101:'admdog',144:'news',7:'echo',389:'ldap',8009:'ajp13',3128:'squid-http',444:'snpp',9999:'abyss',5009:'airport-admin',7070:'realserver',5190:'aol',3000:'ppp',5432:'postgresql',1900:'upnp',3986:'mapper-ws_ethd',13:'daytime',1029:'ms-lsa',9:'discard',5051:'ida-agent',6646:'unknown',49157:'unknown',1028:'unknown',873:'rsync',1755:'wms',2717:'pn-requester',4899:'radmin',9100:'jetdirect',119:'nntp',37:'time',1000:'cadlock',3001:'nessus',5001:'commplex-link',82:'xfer',10010:'rxapi',1030:'iad1',9090:'zeus-admin',2107:'msmq-mgmt',1024:'kdm',2103:'zephyr-clt',6004:'X11:4',1801:'msmq',5050:'mmcc',19:'chargen',8031:'unknown',1041:'danf-ak2',255:'unknown',1049:'td-postman',1048:'neod2',2967:'symantec-av',1053:'remote-as',3703:'adobeserver-3',1056:'vfo',1065:'syscomlan',1064:'jstel',1054:'brvread',17:'qotd',808:'ccproxy-http',3689:'rendezvous',1031:'iad2',1044:'dcutility',1071:'bsquare-voip',5901:'vnc-1',100:'newacct',9102:'jetdirect',8010:'xmpp',2869:'icslap',1039:'sbl',5120:'barracuda-bbs',4001:'newoak',9000:'cslistener',2105:'eklogin',636:'ldapssl',1038:'mtqp',2601:'zebra',1:'tcpmux',7000:'afs3-fileserver',1066:'fpo-fns',1069:'cognex-insight',625:'apple-xsrvr-admin',311:'asip-webadmin',280:'http-mgmt',254:'unknown',4000:'remoteanything',1993:'snmp-tcp-port',1761:'landesk-rc',5003:'filemaker',2002:'globe',2005:'deslogin',1998:'x25-svc-port',1032:'iad3',1050:'java-or-OTGfileshare',6112:'dtspc',3690:'svn',1521:'oracle',2161:'apc-agent',6002:'X11:2',1080:'socks',2401:'cvspserver',4045:'lockd',902:'iss-realsecure',7937:'nsrexecd',787:'qsc',1058:'nim',2383:'ms-olap4',32771:'sometimes-rpc5',1033:'netinfo',1040:'netsaint',1059:'nimreg',50000:'ibm-db2',5555:'freeciv',10001:'scp-config',1494:'citrix-ica',593:'http-rpc-epmap',2301:'compaqdiag',3:'compressnet',1:'tcpmux',3268:'globalcatLDAP',7938:'lgtomapper',1234:'hotline',1022:'exp2',1074:'warmspotMgmt',8002:'teradataordbms',1036:'nsstp',1035:'multidropper',9001:'tor-orport',1037:'ams',464:'kpasswd5',497:'retrospect',1935:'rtmp',6666:'irc',2003:'finger',6543:'mythtv',1352:'lotusnotes',24:'priv-mail',3269:'globalcatLDAPssl',1111:'lmsocialserver',407:'timbuktu',500:'isakmp',20:'ftp-data',2006:'invokator',3260:'iscsi',15000:'hydap',1218:'aeroflight-ads',1034:'zincite-a',4444:'krb524',264:'bgmp',2004:'mailbox',33:'dsp',1042:'afrog',42510:'caerpc',999:'garcon',3052:'powerchute',1023:'netvenuechat',1068:'instl_bootc',222:'rsh-spx',7100:'font-service',888:'accessbuilder',4827:'squid-htcp',1999:'tcp-id-port',563:'snews',1717:'fj-hdnet',2008:'conf',992:'telnets',32770:'sometimes-rpc3',32772:'sometimes-rpc7',7001:'afs3-callback',8082:'blackice-alerts',2007:'dectalk',740:'netcp',5550:'sdadmind',2009:'news',5801:'vnc-http-1',1043:'boinc',512:'exec',2701:'sms-rcinfo',7019:'doceri-ctl',50001:'unknown',1700:'mps-raft',4662:'edonkey',2065:'dlsrpn',2010:'search',42:'nameserver',9535:'man',2602:'ripd',3333:'dec-notes',161:'snmp',5100:'admd',5002:'rfe',2604:'ospfd',4002:'mlchat-proxy',6059:'X11:59',1047:'neod1',8192:'sophos',8193:'sophos',2702:'sms-xfer',6789:'ibm-db2-admin',9595:'pds',1051:'optima-vnet',9594:'msgsys',9593:'cba8',16993:'amt-soap-https',16992:'amt-soap-http',5226:'hp-status',5225:'hp-server',32769:'filenet-rpc',3283:'netassistant',1052:'ddt',8194:'sophos',1055:'ansyslmd',1062:'veracity',9415:'unknown',8701:'unknown',8652:'unknown',8651:'unknown',8089:'unknown',65389:'unknown',65000:'unknown',64680:'unknown',64623:'unknown',55600:'unknown',55555:'unknown',52869:'unknown',35500:'unknown',33354:'unknown',23502:'unknown',20828:'unknown',1311:'rxmon',1060:'polestar',4443:'pharos',730:'netviewdm2',731:'netviewdm3',709:'entrustmanager',1067:'instl_boots',13782:'netbackup',5902:'vnc-2',366:'odmr',9050:'tor-socks',1002:'windows-icfw',85:'mit-ml-dev',5500:'hotline',5431:'park-agent',1864:'paradym-31',1863:'msnp',8085:'unknown',51103:'unknown',49999:'unknown',45100:'unknown',10243:'unknown',49:'tacacs',3495:'seclayer-tcp',6667:'irc',90:'dnsix',475:'tcpnethaspsrv',27000:'flexlm0',1503:'imtc-mcs',6881:'bittorrent-tracker',1500:'vlsi-lm',8021:'ftp-proxy',340:'unknown',78:'vettcp',5566:'westec-connect',8088:'radan-http',2222:'EtherNetIP-1',9071:'unknown',8899:'ospf-lite',6005:'X11:5',9876:'sd',1501:'sas-3',5102:'admeng',32774:'sometimes-rpc11',32773:'sometimes-rpc9',9101:'jetdirect',5679:'activesync',163:'cmip-man',648:'rrp',146:'iso-tp0',1666:'netview-aix-6',901:'samba-swat',83:'mit-ml-dev',9207:'wap-vcal-s',8001:'vcom-tunnel',8083:'us-srv',8084:'websnp',5004:'avt-profile-1',3476:'nppmp',5214:'unknown',14238:'unknown',12345:'netbus',912:'apex-mesh',30:'unknown',2605:'bgpd',2030:'device2',6:'unknown',541:'uucp-rlogin',8007:'ajp12',3005:'deslogin',4:'unknown',1248:'hermes',2500:'rtsserv',880:'unknown',306:'unknown',4242:'vrml-multi-use',1097:'sunclustermgr',9009:'pichat',2525:'ms-v-worlds',1086:'cplscrambler-lg',1088:'cplscrambler-al',8291:'unknown',52822:'unknown',6101:'backupexec',900:'omginitialrefs',7200:'fodms',2809:'corbaloc',395:'netcp',800:'mdbs_daemon',32775:'sometimes-rpc13',12000:'cce4x',1083:'ansoft-lm-1',211:'914c-g',987:'unknown',705:'agentx',20005:'btx',711:'cisco-tdp',13783:'netbackup',6969:'acmsoda',3071:'csd-mgmt-port',5269:'xmpp-server',5222:'xmpp-client',1085:'webobjects',1046:'wfremotertm',5987:'wbem-rmi',5989:'wbem-https',5988:'wbem-http',2190:'tivoconnect',3301:'tarantool',11967:'sysinfo-sp',8600:'asterix',3766:'sitewatch-s',7627:'soap-http',8087:'simplifymedia',30000:'ndmps',9010:'sdr',7741:'scriptview',14000:'scotty-ft',3367:'satvid-datalnk',1099:'rmiregistry',1098:'rmiactivation',3031:'eppc',2718:'pn-requester2',6580:'parsec-master',15002:'onep-tls',4129:'nuauth',6901:'jetstream',3827:'netmpi',3580:'nati-svrloc',2144:'lv-ffx',9900:'iua',8181:'intermapper',3801:'ibm-mgr',1718:'h323gatedisc',2811:'gsiftp',9080:'glrpc',2135:'gris',1045:'fpitp',2399:'fmpro-fdal',3017:'event_listener',10002:'documentum',1148:'elfiq-repl',9002:'dynamid',8873:'dxspider',2875:'dxmessagebase2',9011:'d-star',5718:'dpm',8086:'d-s-n',3998:'dnx',2607:'connection',11110:'sgi-soap',4126:'ddrepl',9618:'condor',2381:'compaq-https',1096:'cnrprotocol',3300:'ceph',3351:'btrieve',1073:'bridgecontrol',8333:'bitcoin',3784:'bfd-control',5633:'beorl',15660:'bex-xr',6123:'backup-express',3211:'avsecuremgmt',1078:'avocent-proxy',5910:'cm',5911:'cpdlc',3659:'apple-sasl',3551:'apcupsd',2260:'apc-2260',2160:'apc-2160',2100:'amiganetfs',16001:'fmsascon',3325:'active-net',3323:'active-net',1104:'xrl',9968:'unknown',9503:'unknown',9502:'unknown',9485:'unknown',9290:'unknown',9220:'unknown',8994:'unknown',8649:'unknown',8222:'unknown',7911:'unknown',7625:'unknown',7106:'unknown',65129:'unknown',63331:'unknown',6156:'unknown',6129:'unknown',60020:'unknown',5962:'unknown',5961:'unknown',5960:'unknown',5959:'unknown',5925:'unknown',5877:'unknown',5825:'unknown',5810:'unknown',58080:'unknown',57294:'unknown',50800:'unknown',50006:'unknown',50003:'unknown',49160:'unknown',49159:'unknown',49158:'unknown',48080:'unknown',40193:'unknown',34573:'unknown',34572:'unknown',34571:'unknown',3404:'unknown',33899:'unknown',32782:'unknown',32781:'unknown',31038:'unknown',30718:'unknown',28201:'unknown',27715:'unknown',25734:'unknown',24800:'unknown',22939:'unknown',21571:'unknown',20221:'unknown',20031:'unknown',19842:'unknown',19801:'unknown',19101:'unknown',17988:'unknown',1783:'unknown',16018:'unknown',16016:'unknown',15003:'unknown',14442:'unknown',13456:'unknown',10629:'unknown',10628:'unknown',10626:'unknown',10621:'unknown',10617:'unknown',10616:'unknown',10566:'unknown',10025:'unknown',10024:'unknown',10012:'unknown',1169:'tripwire',5030:'surfpass',5414:'statusd',1057:'startron',6788:'smc-http',1947:'sentinelsrm',1094:'rootd',1075:'rdrmshc',1108:'ratio-adp',4003:'pxc-splr-ft',1081:'pvuniwien',1093:'proofd',4449:'privatewire',1687:'nsjtp-ctrl',1840:'netopia-vo2',1100:'mctp',1063:'kyoceranetdev',1061:'kiosk',1107:'isoipsigport-2',1106:'isoipsigport-1',9500:'ismserver',20222:'ipulse-ics',7778:'interwise',1077:'imgames',1310:'husky',2119:'gsigatekeeper',2492:'groove',1070:'gmrupdateserv',20000:'dnp',8400:'cvd',1272:'cspmlockmgr',6389:'clariion-evr01',7777:'cbt',1072:'cardax',1079:'asprovatalk',1082:'amt-esd-prot',8402:'abarsd',89:'su-mit-tg',691:'resvc',1001:'webpush',32776:'sometimes-rpc15',1999:'tcp-id-port',212:'anet',2020:'xinupageserver',6003:'X11:3',7002:'afs3-prserver',2998:'iss-realsec',50002:'iiimsf',3372:'msdtc',898:'sun-manageconsole',5510:'secureidprop',32:'unknown',2033:'glogger',4165:'altcp',3061:'cautcpd',99:'metagram',749:'kerberos-adm',425:'icad-el',5903:'vnc-3',43:'whois',5405:'pcduo',6106:'isdninfo',13722:'netbackup',6502:'netop-rc',7007:'afs3-bos',458:'appleqtc',9666:'zoomcp',8100:'xprint-server',3737:'xpanel',5298:'presence',1152:'winpoplanmess',8090:'opsmessaging',2191:'tvbus',3011:'trusted-web',1580:'tn-tl-r1',9877:'x510',5200:'targus-getdata',3851:'spectraport',3371:'satvid-datalnk',3370:'satvid-datalnk',3369:'satvid-datalnk',7402:'rtps-dd-mt',5054:'rlm-admin',3918:'pktcablemmcops',3077:'orbix-loc-ssl',7443:'oracleas-https',3493:'nut',3828:'neteh',1186:'mysql-cluster',2179:'vmrdp',1183:'llsurfup-http',19315:'keyshadow',19283:'keysrvr',3995:'iss-mgmt-ssl',5963:'indy',1124:'hpvmmcontrol',8500:'fmtp',1089:'ff-annunc',10004:'emcrmirccd',2251:'dif-port',1087:'cplscrambler-in',5280:'xmpp-bosh',3871:'avocent-adsap',3030:'arepa-cas',62078:'iphone-sync',5904:'ag-swim',9091:'xmltec-xmlmail',4111:'xgrid',1334:'writesrv',3261:'winshadow',2522:'windb',5859:'wherehoo',1247:'visionpyramid',9944:'unknown',9943:'unknown',9110:'unknown',8654:'unknown',8254:'unknown',8180:'unknown',8011:'unknown',7512:'unknown',7435:'unknown',7103:'unknown',61900:'unknown',61532:'unknown',5922:'unknown',5915:'unknown',5822:'unknown',56738:'unknown',55055:'unknown',51493:'unknown',50636:'unknown',50389:'unknown',49175:'unknown',49165:'unknown',49163:'unknown',3546:'unknown',32784:'unknown',27355:'unknown',27353:'unknown',27352:'unknown',24444:'unknown',19780:'unknown',18988:'unknown',16012:'unknown',15742:'unknown',10778:'unknown',4006:'pxc-spvr',2126:'pktcable-cops',4446:'n1-fwp',3880:'igrs',1782:'hp-hcip',1296:'dproxy',9998:'distinct32',9040:'tor-trans',32779:'sometimes-rpc21',1021:'exp1',32777:'sometimes-rpc17',2021:'servexec',32778:'sometimes-rpc19',616:'sco-sysmgr',666:'doom',700:'epp',5802:'vnc-http-2',4321:'rwhois',545:'ekshell',1524:'ingreslock',1112:'msql',49400:'compaqdiag',84:'ctf',38292:'landesk-cba',2040:'lam',32780:'sometimes-rpc23',3006:'deslogind',2111:'kx',1084:'ansoft-lm-2',1600:'issd',2048:'dls-monitor',2638:'sybase',9111:'DragonIDSConsole',6699:'napster',16080:'osxwebadmin',6547:'powerchuteplus',6007:'X11:7',1533:'virtual-places',5560:'isqlplus',2106:'ekshell',1443:'ies-lm',667:'disclose',720:'unknown',2034:'scoremgr',555:'dsf',801:'device',6025:'x11',3221:'xnm-clear-text',3826:'wormux',9200:'wap-wsp',2608:'wag-service',4279:'vrml-multi-use',7025:'vmsvc-2',11111:'vce',3527:'beserver-msg-q',1151:'unizensus',8200:'trivnet1',8300:'tmi',6689:'tsa',9878:'kca-service',10009:'swdtp-sv',8800:'sunwebadmin',5730:'unieng',2394:'ms-olap2',2393:'ms-olap1',2725:'msolap-ptp2',5061:'sip-tls',6566:'sane-port',9081:'cisco-aqos',5678:'rrac',5906:'rpas-c2',3800:'pwgpsi',4550:'gds-adppiw-db',5080:'onscreen',1201:'nucleus-sand',3168:'poweronnud',3814:'neto-dcs',1862:'mysql-cm-agent',1114:'mini-sql',6510:'mcer-port',3905:'mupdate',8383:'m2mservices',3914:'listcrt-port-2',3971:'lanrevserver',3809:'apocd',5033:'jtnetd-server',7676:'imqbrokerd',3517:'802-11-iapp',4900:'hfcs',3869:'ovsam-mgmt',9418:'git',2909:'funk-dialout',3878:'fotogcad',8042:'fs-agent',1091:'ff-sm',1090:'ff-fms',3920:'exasoftport1',6567:'esp',1138:'encrypted_admin',3945:'emcads',1175:'dossier',10003:'documentum_s',3390:'dsc',5907:'dsd',3889:'dandv-tester',1131:'caspssl',8292:'blp3',5087:'biotic',1119:'bnetgame',1117:'ardus-mtrns',4848:'appserv-http',7800:'asr',16000:'fmsas',3324:'active-net',3322:'active-net',5221:'3exmp',4445:'upnotifyp',9917:'unknown',9575:'unknown',9099:'unknown',9003:'unknown',8290:'unknown',8099:'unknown',8093:'unknown',8045:'unknown',7921:'unknown',7920:'unknown',7496:'unknown',6839:'unknown',6792:'unknown',6779:'unknown',6692:'unknown',6565:'unknown',60443:'unknown',5952:'unknown',5950:'unknown',5862:'unknown',5850:'unknown',5815:'unknown',5811:'unknown',57797:'unknown',56737:'unknown',5544:'unknown',55056:'unknown',5440:'unknown',54328:'unknown',54045:'unknown',52848:'unknown',52673:'unknown',50500:'unknown',50300:'unknown',49176:'unknown',49167:'unknown',49161:'unknown',44501:'unknown',44176:'unknown',41511:'unknown',40911:'unknown',32785:'unknown',32783:'unknown',30951:'unknown',27356:'unknown',26214:'unknown',25735:'unknown',19350:'unknown',18101:'unknown',18040:'unknown',17877:'unknown',16113:'unknown',15004:'unknown',14441:'unknown',12265:'unknown',12174:'unknown',10215:'unknown',10180:'unknown',4567:'tram',6100:'synchronet-db',4004:'pxc-roid',4005:'pxc-pin',8022:'oa-system',9898:'monkeycom',7999:'irdmi2',1271:'excw',1199:'dmidi',3003:'cgms',1122:'availant-mgr',2323:'3d-nfsd',4224:'xtell',2022:'down',617:'sco-dtmgr',777:'multiling-http',417:'onmux',714:'iris-xpcs',6346:'gnutella',981:'unknown',722:'unknown',1009:'unknown',4998:'maybe-veritas',70:'gopher',1076:'sns_credit',5999:'ncd-conf',10082:'amandaidx',765:'webster',301:'unknown',524:'ncp',668:'mecomm',2041:'interbase',6009:'X11:9',1417:'timbuktu-srv1',1434:'ms-sql-m',259:'esro-gen',44443:'coldfusion-auth',1984:'bigbrother',2068:'avocentkvm',7004:'afs3-kaserver',1007:'unknown',4343:'unicall',416:'silverplatter',2038:'objectmanager',6006:'X11:6',109:'pop2',4125:'rww',1461:'ibm_wrless_lan',9103:'jetdirect',911:'xact-backup',726:'unknown',1010:'surf',2046:'sdfunc',2035:'imsldoc',7201:'dlip',687:'asipregistry',2013:'raid-am',481:'dvs',125:'locus-map',6669:'irc',6668:'irc',903:'iss-console-mgr',1455:'esl-lm',683:'corba-iiop',1011:'unknown',2043:'isis-bcast',2047:'dls',256:'fw1-secureremote',9929:'nping-echo',5998:'ncd-diag',406:'imsp',31337:'Elite',44442:'coldfusion-auth',783:'spamassassin',843:'unknown',2042:'isis',2045:'cdfunc',4040:'yo-main',6060:'x11',6051:'x11',1145:'x9-icue',3916:'wysdmc',9443:'tungsten-https',9444:'wso2esb-console',1875:'westell-stats',7272:'watchme-7272',4252:'vrml-multi-use',4200:'vrml-multi-use',7024:'vmsvc',1556:'veritas_pbx',13724:'vnetd',1141:'mxomss',1233:'univ-appserver',8765:'ultraseek-http',1137:'trim',3963:'thrp',5938:'teamviewer',9191:'sun-as-jpda',3808:'sun-as-iiops-ca',8686:'sun-as-jmxrmi',3981:'starfish',2710:'sso-service',3852:'sse-app-config',3849:'spw-dnspreload',3944:'sops',3853:'sscan',9988:'nsesrvr',1163:'sddp',4164:'silverpeakcomm',3820:'scp',6481:'servicetags',3731:'smap',5081:'sdl-ets',40000:'safetynetp',8097:'sac',4555:'rsip',3863:'asap-tcp',1287:'routematch',4430:'rsqlserver',7744:'raqmon-pdu',1812:'radius',7913:'qo-secure',1166:'qsm-remote',1164:'qsm-proxy',1165:'qsm-gui',8019:'qbdb',10160:'qb-db-server',4658:'playsta2-app',7878:'owms',3304:'opsession-srvr',3307:'opsession-prxy',1259:'opennl-voice',1092:'obrpd'}
		elif tport == "-p-":
			portas = range(65535)

		hd = "PORTA           SERVIÃ‡O"

		if tipo == "s":
			semaforo = threading.Semaphore(50)
			print(f"Iniciando SYN Scan\n{hd}")
			for porta in portas:
				t = threading.Thread(target=self.synScan, args=(addr,porta,))
				t.start()

		elif tipo == "n":
			print(f"Iniciando Scan normal\n{hd}")
			for porta in portas:
				t = threading.Thread(target=self.checkPort, args=(addr,porta,))
				t.start()
